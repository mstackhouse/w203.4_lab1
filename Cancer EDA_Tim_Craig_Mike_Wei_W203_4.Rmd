---
title: "Cancer EDA_Tim_Mike_Craig_W203_4"
author: "Tim, Mike, Craig, Wei"
date: "1/21/2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=80),tidy=TRUE)
library(car)
library(rmarkdown)
library(ggplot2)
library(corrplot)
library(stringr)
```

# Introduction

This report presents an initial exporatory data analysis identifying the key features associated with cancer rates and deaths based on geographic location in the form of a county in the United States. The  goal is to use the findings from the analysis to develop strategies to improve future outcomes cancer. We are a team of data scientists motivated to in promote understanding the societal factors that impact mortality rates of cancer among various communities in the United States.  We are grateful for the grant awarded to us by a health government agency to complete this study. 

## Research Question

Our task was to answer these two key research quesitons :

1. What are the key county level characteristics associated with mortality rates from cancer?
2. Are there trends in county level characteristics that can be identified to inform social intervention to decrease cancer mortality rates?

## About the Data
```{r Load_dataset, collapse = TRUE}
df <- read.csv("cancer.csv")
class(df) # dimensions are 3047 rows x 30 columns
dim(df) # dimensions of the data set
```
The dataset that we explored had `r nrow(df)` observations and `r ncol(df)` variables. The majority of the data types are either number or integer with Geography and binnedInc as factors. The death rate was designated the target variable by the health government agency. Each observation represents a single county within the United States, and each variable describes that county for a number of different ways. The dataset provided came with with a mininaml data dictionary and is presented in Table 1. Most of the variables not defined were self explanatory by key notations in the variable name such 'Pct' for percent, 'Avg' for average, and 'med' for median. The units for death rate and birth rates were not provided and without a means to confirm the units we chose to leave these variables without units. We further grouped variables into categories based on similiarities to help organize the analysis. Some data processing was required to address select issues as described in the section *Data Quality*.


**Table 1. Data Dictionary:**

| Variable Name          | Variable Description                                                       |category         |
|------------------------|----------------------------------------------------------------------------|-----------------|
| deathRate*             | rate of deaths due to cancer                                               |outcome          |
| avgAnnCount            | 2009 - 2013 mean incidents of cancer per county.                           |cancer indcidence|
| Geography*             | Description of county location  (county name, state)                       |county           |
| popEst2015             | County population, estimated during 2015                                   |population/Birth |
| BirthRate*             |                                                                            |population/Birth |
| MedianAge*             | Median age of county residents                                             |age         |
| MedianAgeMale*         | Median age of Male county residents                                        |age         |
| MedianAgeFemale*       | Median age of Female county residents                                      |age         |
| PctWhite*              | % of residents with race designation: White                                |ethnicity   |
| PctBlack*              | % of residents with race designation: Black                                |ethnicity   |
| PctAsian*              | % of residents with race designation: Asian                                |ethnicity   |
| PctOtherRace*          | % of residents with race designation: Other                                |ethnicity   |
| AvgHouseholdSize*      | Average household size, number of people                                   |Household/Marital|
| PercentMarried*        | % maried                                                                   |Household/Marital|
| PctMarriedHouseholds*  | % of households that are married                                           |Household/Marital|
| PctNoHS18_24*          | % of residents, age 18-24, without completing a high school education      |Education        |
| PctHS18_24*            | % of residents, age 18-24, with a high school degree (highest education)   |Education        |
| PctSomeCol18_24*       | % of residents, age 18-24, with some college education (no degree)         |Education        |
| PctBachDeg18_24*       | % of residents, age 18-24, with a bachelor's degree                        |Education        |
| PctHS25_Over*          | % of residents, age over 25, with a high school degree (highest education) |Education        |
| PctBachDeg25_Over*     | % of residents, age over 25, with a bachelors degree                       |Education        |
| PctPrivateCoverage     | % of residents with private insurance coverage                             |insurance        |
| PctEmpPrivCoverage*    | % of residents with employee-provided private insurance coverage           |insurance        |
| PctPublicCoverage      | % of residents with public insurance coverage                              |insurance        |
| PctEmployed16_Over*    | % of residents, age over 16, that are employed                             |Employment       |
| PctUnemployed16_Over*  | % of residents, age over 16, that are unemployed                           |Employment       |
| medIncome*             | Median Income                                                              |income           |
| povertyPercent         | % of county residents living below the poverty line                        |income           |
| binnedInc*             | Binned income level                                                        |income           |

```{r}
str(df) #names of columns and variable types
```
## Data Quality
The dataset was inspected using the following methods: 

1. calucating the min, max, mean, median, 1st and 3rd quartile and identifying missing values (ie NA) using summary function 

2. visually inspect univariate data with histograms and boxplots  

3. Scatterplots were completed for all independent variables against the deathrate. Note some scatterplots are not shown.  

### Missing Data
**PctSomeCol18_24:**
The variable for percentage of residents with some college education, aged 18-24, had `r sum(is.na(df$PctEmployed16_Over))` missing values (NA) `r round(100*(sum(is.na(df$PctEmployed16_Over)))/(nrow(df)),3)`% of the variable's rows.  We will conduct the analysis with the observations with the data. 

Tim: After thinking about this some more, I would vote to keep in this data with the caveat that there is a significant amount of data missing. the smaller subset might show something. 

**PctEmployed16_Over**
The variable for percentage of residents over 16 years old and employed has `r sum(is.na(df$PctSomeCol18_24))` missing values (NA).  This represents a very large portion of the overall dataset - `r round(100*(sum(is.na(df$PctSomeCol18_24)))/(nrow(df)),3)`% of the variable's rows.  Due to the large number of missing values, this variable was not considered a key variable of the dataset.

### Data suspected of being erroroneous
**Median Age: **
There are `r sum(is.na(df$MedianAge[df$MedianAge>300]))` observations (`r round(100*(sum(is.na(df$MedianAge[df$MedianAge>300]))/(nrow(df))),5)`%`with median age>300. A median age of a county over 300 years of age is impossible in real life and these observations were removed.  This represents a small portion of the dataset. 

**Household size below:**
There are `r sum((df$AvgHouseholdSize<1), na.rm=TRUE)` counties reporting average household size less than 1 representing `r round(100*(sum((df$AvgHouseholdSize<1), na.rm=TRUE))/(nrow(df)),3)`% of the observations. While it is reasonable to define a household as 1 or more persons living in the same occupancy space, a conclusive definition of a household was not provided with the dataset. For this reason in conjunction with the small percentage of affected rows, we kept these observations in the dataset. 

**avgAnnCount:**
There are `r sum(df$avgAnnCount>=1962 & df$avgAnnCount<1963)` observations (`r round(100*(sum(df$avgAnnCount>=1962 & df$avgAnnCount<1963)/(nrow(df))),2)`%`with the same value of 1962.667684.There are nine  It is likely these data points are erroneous; however, there are 9 observations greater than 1962.667684; therefore, we cannot determine conclusively which are erroneous. For this reason we kept these observations in the dataset. 


```{r}
# Dataframe created to count frequency of each county name. 
GeoFreq <-as.data.frame(table(df$Geography))
GeoFreq[GeoFreq$Freq != 1,] # All counties listed only once 
```


# Univariate Analysis of Key Variables
Univariate analysis is shown in completness because of the issues described. It is important to have a strong understanding of the data 
## Outcome deathRate and Average Annual Rate of Cancer

Summary Statistics:

The cancer mortality rates are normally distributed. However, the average annual count of cancer is extremely right skewed due do magnitude changes. To help visualize the distribution, a log transformation was performed and produced a normal distribution curve in the histogram except for a bar count  

```{r}
summary(data.frame(df$deathRate, df$avgAnnCount) )
```

```{r,fig.height=5, fig.width=10 }
par(mfrow=c(2,4))
color = c('lightskyblue1', 'gray')

title = 'Cancer Death Rate per County'
hist(df$deathRate, main= title ,breaks =30, ylab = 'number of counties', xlab = ''  ,col = color[1])
boxplot( df$deathRate,main = title, col = color, ylab = 'number of counties'  , xlab  = paste(c('n = ' ,  sum(df$deathRate>0, na.rm=TRUE) ),collapse= ""))

title = 'Average Annual Count of Cancer'
hist(df$avgAnnCount,main= title ,breaks =30, ylab = 'number of counties', xlab = 'Avg Annual Count',col =color[2])
boxplot( df$avgAnnCount,main = title  ,col =color, ylab = 'Avg Annual Count' , xlab  = paste(c('n = ' , sum(df$avgAnnCount>0, na.rm=TRUE) ), collapse= ""))

title = 'log Avg Annual Count of Cancers'
hist(log(df$avgAnnCount,10),main= title ,breaks =30, ylab = 'number of counties', xlab = 'log10 Avg Annual Count',col =color[2])
boxplot( log(df$avgAnnCount,10),main = title  ,col =color, ylab = 'log10 Avg Annual Count' , xlab  = paste(c('n = ' , sum(log(df$avgAnnCount,10)>0, na.rm=TRUE) ), collapse= ""))
```



## Population and birth
The counties ranged in population of `r min(df$popEst2015)` from `r df[df$popEst2015==min(df$popEst2015),'Geography']` to `r max(df$popEst2015)` in `r df[df$popEst2015==max(df$popEst2015),'Geography']`. There `r sum(df$popEst2015>1e+6)` counties that are have populations greater than 1 million and this produces an extreme right skew when the population is graphed on a histogram. Log transformations of the poulation helps visualize a distibution curve that looks normal. The birth rate didn't raise any concerns partly because we do not have the units to fully assess this variable. 

Summary Statistics:
```{r}
summary(data.frame(df$popEst2015, df$BirthRate) )
```
```{r,fig.height=2.5, fig.width=10 }
par(mfrow=c(1,5))
title = c('County Population in 2015', 'Log County Pop in 2015', 'County BirthRate')
y = c('number of counties', 'log10 population','population','rate')
x = c('population','log10 population','rate')
hist(df$popEst2015        ,main=title[1],breaks=30   ,ylab=y[1],xlab = x[1],col ='blue')
hist(log(df$popEst2015,10)   ,main=title[2],breaks=30   ,ylab=y[1],xlab = x[2],col ='lightskyblue1')
boxplot(log(df$popEst2015,10),main=title[2],col='lightskyblue1',ylab=y[2],xlab=paste(c('n=',sum(df$popEst2015>=0, na.rm=TRUE)),collapse=""))

hist(df$BirthRate   ,main=title[3],breaks=30   ,ylab=y[1],xlab = x[3],col ='gray')
boxplot(df$BirthRate,main=title[3],col='gray',ylab=y[4],xlab=paste(c('n=',sum(df$BirthRate>=0, na.rm=TRUE)),collapse=""))
```

## Age


```{r}
#sum((df$MedianAge>300), na.rm=TRUE) # identifies 30 observations median age greater than 300
df$MedianAge_gr100 = 0 #creates a new column to save the dubious data
df$MedianAge_gr100[df$MedianAge>300]<- df$MedianAge[df$MedianAge>300]  # saves the dubious data
df$MedianAge[df$MedianAge>300]<- NA #update the Median Age
```

```{r,fig.height=2.0, fig.width=11 }
par(mfrow=c(1,6))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1')
title = c('Median Age', 'Median Age of Males', 'Median Age of Femles')
y = c('number of counties', 'percent')
x = c('percent')
hist(df$MedianAge      ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$MedianAgeMale  ,main= title[2],breaks=30, ylab=y[1], xlab = x[1],col =color[2])
hist(df$MedianAgeFemale,main= title[3],breaks=30, ylab=y[1], xlab = x[1],col =color[3])

boxplot(df$MedianAge,      main=title[1],col=color[1],ylab=y[2],xlab=paste(c('n=',sum(df$MedianAge>=0, na.rm=TRUE)),collapse=""))
boxplot(df$MedianAgeMale,  main=title[2],col=color[2],ylab=y[2],xlab=paste(c('n=',sum(df$MedianAgeMale>=0, na.rm=TRUE)),collapse=""))
boxplot(df$MedianAgeFemale,main=title[3],col=color[3],ylab=y[2],xlab=paste(c('n=',sum(df$MedianAgeFemale>=0, na.rm=TRUE)),collapse=""))
```
## Ethnicity
Summary Statistics:
```{r}
summary(data.frame(df$PctWhite, df$PctBlack, df$PctAsian, df$PctOtherRace), digits=3 )
```

```{r,fig.height=4.5, fig.width=10 }
par(mfrow=c(2,4))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1')
title = c('PerWhite', 'Black', 'Asian', 'Other Race')
y = c('number of counties', 'percent')
x = c('percent')
hist(df$PctWhite    ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$PctBlack    ,main= title[2],breaks=30, ylab=y[1], xlab = x[1],col =color[2])
hist(df$PctAsian    ,main= title[3],breaks=30, ylab=y[1], xlab = x[1],col =color[3])
hist(df$PctOtherRace,main= title[4],breaks=30, ylab=y[1], xlab = x[1],col =color[4])

boxplot(df$PctWhite,main=title[1],col=color[1],ylab=y[2],xlab=paste(c('n=',sum(df$PctWhite>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctBlack,main=title[2],col=color[2],ylab=y[2],xlab=paste(c('n=',sum(df$PctBlack>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctAsian,main=title[3],col=color[3],ylab=y[2],xlab=paste(c('n=',sum(df$PctAsian>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctOtherRace,main=title[4],col=color[4],ylab=y[2],xlab=paste(c('n=',sum(df$PctOtherRace>=0, na.rm=TRUE)),collapse=""))
```
## Household and Marital status
There are `r sum((df$AvgHouseholdSize<1), na.rm=TRUE)` counties reporting average household size less than 1 representing `r round(100*(sum((df$AvgHouseholdSize<1), na.rm=TRUE))/(nrow(df)),3)`% of the observations. While it is reasonable to define a household as 1 or more persons living in the same occupancy space, a conclusive definition of a household was not provided with the dataset. For this reason in conjunction with the small percentage of affected rows, we left these observations in the dataset. 

Summary Statistics
```{r}
summary(data.frame(df$PercentMarried, df$AvgHouseholdSize, df$PctMarriedHouseholds), digits=3 )
```

```{r,fig.height=2.5, fig.width=12 }
par(mfrow=c(1,6))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1')
title = c('Percent Married', 'Averarge Household size', 'Percent Married Households')
y = c('number of counties', 'percent', 'Household size')
x = c('percent','Household size')
hist(df$PercentMarried      ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$PctMarriedHouseholds,main= title[2],breaks=30, ylab=y[1], xlab = x[2],col =color[2])
hist(df$AvgHouseholdSize    ,main= title[3],breaks=30, ylab=y[1], xlab = x[1],col =color[3])
yl = c(20, 80)
boxplot(df$PercentMarried,main=title[1],col=color[1],ylab=y[2], ylim =yl,
        xlab=paste(c('n=',sum(df$PercentMarried>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctMarriedHouseholds,main=title[2],col=color[2],ylab=y[3], ylim =yl,
        xlab=paste(c('n=',sum(df$PctMarriedHouseholds>=0, na.rm=TRUE)),collapse=""))
boxplot(df$AvgHouseholdSize,main=title[3],col=color[3],ylab=y[2],
        xlab=paste(c('n=',sum(df$AvgHouseholdSize>=0, na.rm=TRUE)),collapse=""))
```

## Education

The variables related to education can roughly be grouped as: 

1. Some high school education (PctNoHS18_24)
2. High school completed  (PctHS18_24, PctHS25_Over)
3. Some college education (PctSomeCol18_24)
4. Bachelor's degree completed (PctBachDeg18_24, PctBachDeg25_Over)

As stated previously, the only variable for *some college education*, PctSomeCol18_24, had a significant portion of data missing, and thus will not be considered in this analysis.

Summary Statistics:
```{r}
summary(data.frame(df$PctNoHS18_24, df$PctHS18_24, df$PctHS25_Over, df$PctBachDeg18_24, df$PctBachDeg25_Over), digits = 4)
```
The basic summary statistics seem plausible and don't contain any concerning results.  As expected, the percentage of county residents without a highschool degree is relatively low with a median of 17%, and roughly half of the percentage as those that have completed high school.  It was also interesting to note that the interquartile range (IQR) was very similar for *PctHS18_24* and *PctHS25_Over* with the primary difference being at the extreme ends - the 18-24 range went as low as 0% and a max of 72.%, while the over 25 age group more centered with a minimum of 7.5% and a max of 54%.  This should be expected because the over-25 age group likely includes more people, as well as the extra time and opportunity to complete a high school degree.  

The following histogram plots show the distributions of the education variables.


```{r,fig.height=5, fig.width=10 }
par(mfrow=c(2,5))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1', 'plum2')
title = c("High school not completed, 18-24", "High school only, 18-24", "College degree, 18-24","High school only, 25+","College degree, 25+")
y = c('number of counties')
x = c('percent')
yl = c(0, 75)
hist(df$PctNoHS18_24     ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$PctHS18_24       ,main= title[2],breaks=30, ylab=y[1], xlab = x[1],col =color[2])
hist(df$PctBachDeg18_24  ,main= title[3],breaks=30, ylab=y[1], xlab = x[1],col =color[3])
hist(df$PctHS25_Over     ,main= title[4],breaks=30, ylab=y[1], xlab = x[1],col =color[4])
hist(df$PctBachDeg25_Over,main= title[5],breaks=30, ylab=y[1], xlab = x[1],col =color[5])

boxplot(df$PctNoHS18_24,     main=title[1],col=color[1],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctNoHS18_24>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctHS18_24,       main=title[2],col=color[2],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctHS18_24>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctBachDeg18_24,  main=title[3],col=color[3],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctBachDeg18_24>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctHS25_Over,     main=title[4],col=color[4],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctBachDeg18_24>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctBachDeg25_Over,main=title[5],col=color[5],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctBachDeg25_Over>=0, na.rm=TRUE)),collapse=""))
```

Of the five variables considered, only *PctHS18_24* showed a normal distribution.  The other variables had some skew, either positive or negative.  The variable *PctNoHS18_24*, no high school education, for example showed a left skew meaning that smaller percentages, 10-20%, were much more common than high percentages, 30+%.  Conversely, the distribution of county residents that only had a high school education, *PctHS25_Over*, had a postive right skew, with highly percentages much more common than low percentages.  

The variable *PctBachDeg18_24* was the most extreme distribution with a far-left skew.  This is likely due to the deinition of the variable.  Most people start college at age 18 and finish by age 22-23.  Because the age window was 18-24, the majority of considered residents would not have had an opportunity to yet finish college.  This observed skew is less pronounced for the variable *PctBachDeg25_Over*, which includes all county residents over the age of 25.  For this reason, *PctBachDeg18_24* will not be considered a key variable.

## Insurance Coverage




Summary Statistics:
```{r}
summary(data.frame(df$PctNoHS18_24, df$PctHS18_24, df$PctHS25_Over, df$PctBachDeg18_24, df$PctBachDeg25_Over), digits = 4)
```

```{r,fig.height=2.5, fig.width=12 }
par(mfrow=c(1,6))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1')
title = c('Pct Private Insurance', 'Pct Employee Private Insurance', 'Pct Public Insurance')
y = c('number of counties','percent')
x = c('percent')
yl = c(10, 90)
hist(df$PctPrivateCoverage    ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$PctEmpPrivCoverage    ,main= title[2],breaks=30, ylab=y[1], xlab = x[1],col =color[2])
hist(df$PctPublicCoverage    ,main= title[3],breaks=30, ylab=y[1], xlab = x[1],col =color[3])

boxplot(df$PctPrivateCoverage,main=title[1],col=color[1],ylab=y[2],ylim =yl,
        xlab=paste(c('n=',    sum(df$PctPrivateCoverage>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctEmpPrivCoverage,main=title[2],col=color[2],ylab=y[2],ylim =yl,
        xlab=paste(c('n=',    sum(df$PctEmpPrivCoverage>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctPublicCoverage, main=title[3],col=color[3],ylab=y[2],ylim =yl,
        xlab=paste(c('n=',    sum(df$PctPublicCoverage>=0, na.rm=TRUE)),collapse=""))
```

## Employment

Other than teh 152 missing data observations, the two variables describing employment of residents 16 years or older show a a normal distribution.  

Summary Statistics:

```{r}
summary(data.frame(df$PctEmployed16_Over, df$PctUnemployed16_Over), digits = 3)
```
```{r,fig.height=2.5, fig.width=10 }
par(mfrow=c(1,4))
color = c('lightskyblue1','gray','khaki1', 'darkseagreen1', 'plum2')
title = c('Employed 16 yrs or older', 'Unemployed 16 yrs or older')
y = c('number of counties','percent')
x = c('percent')
yl = c(0, 80)
hist(df$PctEmployed16_Over     ,main= title[1],breaks=30, ylab=y[1], xlab = x[1],col =color[1])
hist(df$PctHS18_24       ,main= title[2],breaks=30, ylab=y[1], xlab = x[1],col =color[2])

boxplot(df$PctEmployed16_Over,     main=title[1],col=color[1],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctEmployed16_Over>=0, na.rm=TRUE)),collapse=""))
boxplot(df$PctHS18_24,       main=title[2],col=color[2],ylab=y[2],ylim=yl,
        xlab=paste(c('n=',   sum(df$PctHS18_24>=0, na.rm=TRUE)),collapse=""))
```



## Income and Poverty level



Median income was provide for each county and assigned a bin containing 302-306 observations. We confirmed that the 10 income bins are based on the deciles of the median income of the dataset. Median income has a right skew. Percent residents below thet poverty level was also included the dataset and presents a right skew as well. 

The binned income 
```{r ,fig.height=4, fig.width=12 }
df$binnedInc <- factor(df$binnedInc , levels = c('[22640, 34218.1]', '(34218.1, 37413.8]', '(37413.8, 40362.7]', '(40362.7, 42724.4]', '(42724.4, 45201]', '(45201, 48021.6]', '(48021.6, 51046.4]' , '(51046.4, 54545.6]' , '(54545.6, 61494.5]' ,'(61494.5, 125635]' ))
summary(df$binnedInc)
```
```{r ,fig.height=3, fig.width=12 }
boxplot(df$medIncome ~ df$binnedInc, data = df, cex.axis = .58 ,main = "income categories", ylab = "median income", col='lightskyblue1')
```

```{r,fig.height=2.5, fig.width=10 }
par(mfrow=c(1,4))
color = 'lightskyblue1'

title =  'Median Income'
hist(df$medIncome, main= title ,breaks =30, ylab = 'number of counties', xlab = ''  ,col = color)
boxplot( df$medIncome,main = title, col = color, ylab = 'Median Income'  , xlab  = paste(c('n = ' ,  sum(df$medIncome>=0, na.rm=TRUE) ),collapse= ""))

color = 'gray'
title = 'Percent below Poverty Level'
hist(df$povertyPercent,main= title ,breaks =30, ylab = 'number of counties', xlab = 'Avg Annual Count',col =color)
boxplot( df$povertyPercent,main = title  ,col =color, ylab = 'Percent below Poverty Level' , xlab  = paste(c('n = ' , sum(df$povertyPercent>0, na.rm=TRUE) ), collapse= ""))
``` 
# Analysis of Key Relationships
Table below show below shows the correlation coeffiencients fof r
```{r, collapse = TRUE, , tidy =TRUE}

# Mike replace with your For loop 

cor(df$deathRate, df$avgAnnCount,  use = 'complete.obs')
cor(df$deathRate, df$BirthRate,  use = 'complete.obs')
cor(df$deathRate, df$MedianAge,  use = 'complete.obs')
cor(df$deathRate, df$MedianAgeMale,  use = 'complete.obs')
cor(df$deathRate, df$MedianAgeFemale,  use = 'complete.obs')
cor(df$deathRate, df$PctWhite,  use = 'complete.obs')
cor(df$deathRate, df$PctBlack,  use = 'complete.obs')
cor(df$deathRate, df$PctAsian,  use = 'complete.obs')
cor(df$deathRate, df$PctOtherRace,  use = 'complete.obs')
cor(df$deathRate, df$PercentMarried,  use = 'complete.obs')
cor(df$deathRate, df$PctMarriedHouseholds,  use = 'complete.obs')
cor(df$deathRate, df$AvgHouseholdSize,  use = 'complete.obs')
cor(df$deathRate, df$popEst2015,  use = 'complete.obs')
cor(df$deathRate, df$PctNoHS18_24,  use = 'complete.obs')
cor(df$deathRate, df$PctHS18_24,  use = 'complete.obs')
cor(df$deathRate, df$PctSomeCol18_24,  use = 'complete.obs')
cor(df$deathRate, df$PctBachDeg18_24,  use = 'complete.obs')
cor(df$deathRate, df$PctHS25_Over,  use = 'complete.obs')
cor(df$deathRate, df$PctBachDeg25_Over,  use = 'complete.obs')
cor(df$deathRate, df$PctPrivateCoverage,  use = 'complete.obs')
cor(df$deathRate, df$PctEmpPrivCoverage,  use = 'complete.obs')
cor(df$deathRate, df$PctPublicCoverage,  use = 'complete.obs')
cor(df$deathRate, df$PctEmployed16_Over,  use = 'complete.obs')
cor(df$deathRate, df$PctUnemployed16_Over,  use = 'complete.obs')
cor(df$deathRate, df$povertyPercent,  use = 'complete.obs')
cor(df$deathRate, df$medIncome,  use = 'complete.obs')
```


## Population Birth rate
|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	avgAnnCount		| `r cor(df$deathRate, df$avgAnnCount,  use = 'complete.obs')	`|
|	BirthRate		| `r cor(df$deathRate, df$BirthRate,  use = 'complete.obs')	`|
|	popEst2015		| `r cor(df$deathRate, df$popEst2015,  use = 'complete.obs')	`|


## Age 
Age did not show any correlation with death rate. 
|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	MedianAge		| `r cor(df$deathRate, df$MedianAge,  use = 'complete.obs')`|
|	MedianAgeMale		| `r cor(df$deathRate, df$MedianAgeMale,  use = 'complete.obs')	`|
|	MedianAgeFemale		| `r cor(df$deathRate, df$MedianAgeFemale,  use = 'complete.obs')	`|


## Ethnicity
|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	PctWhite		| `r cor(df$deathRate, df$PctWhite,  use = 'complete.obs')	`|
|	PctBlack		| `r cor(df$deathRate, df$PctBlack,  use = 'complete.obs')	`|
|	PctAsian		| `r cor(df$deathRate, df$PctAsian,  use = 'complete.obs')	`|
|	PctOtherRace		| `r cor(df$deathRate, df$PctOtherRace,  use = 'complete.obs')	`|

```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$deathRate, df$PctBlack,  use = 'complete.obs'),5)
scatterplot(df$PctBlack, df$deathRate, xlab="Percentage of residents black", 
            ylab="Death Rate",main="Cancer death rate vs. percent county of black ethnicity",legend ('topleft',bty='n', legend=paste('r=',r_cor) ), col=c('red','green', rgb(0,0,250,100,maxColorValue=255)))
```

## Household size and Marital status 

Average household size did not have any correlation with death rate. However, being married and and being married

|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	PercentMarried		| `r cor(df$deathRate, df$PercentMarried,  use = 'complete.obs')	`|
|	PctMarriedHouseholds		| `r cor(df$deathRate, df$PctMarriedHouseholds,  use = 'complete.obs')	`|
|	AvgHouseholdSize		| `r cor(df$deathRate, df$AvgHouseholdSize,  use = 'complete.obs')	`|

## Education
To begin, a correlation matrix of the education variables is shown vs. the target variable *deathRate*

|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	PctNoHS18_24		| `r cor(df$deathRate, df$PctNoHS18_24,  use = 'complete.obs')	`|
|	PctHS18_24		| `r cor(df$deathRate, df$PctHS18_24,  use = 'complete.obs')	`|
|	PctSomeCol18_24		| `r cor(df$deathRate, df$PctSomeCol18_24,  use = 'complete.obs')	`|
|	PctBachDeg18_24		| `r cor(df$deathRate, df$PctBachDeg18_24,  use = 'complete.obs')	`|
|	PctHS25_Over		| `r cor(df$deathRate, df$PctHS25_Over,  use = 'complete.obs')	`|
|	PctBachDeg25_Over		| `r cor(df$deathRate, df$PctBachDeg25_Over,  use = 'complete.obs')	`|


The first thing to note is that the correlations to death rate of the 18-24 age variables were generally weaker compared to the broader "over 25" age variables.  One weakness of the dataset is that the absolute quantities of these variables are unknown - only the percentage is known.  For that reason, it may be safe to presume that the 18-24 age variables are prone to more variation and worse correlation to the dependent variable, death rate.

Observing only the two "over 25 age" variables, we see two disticntly different trends.  The first - percentage of residents with a college degree - shows a moderately decreasing trend with a negative correation of `r cor(df$deathRate, df$PctBachDeg25_Over)`.

```{r,fig.height=4, fig.width=6 }
scatterplot(df$PctBachDeg25_Over, df$deathRate, xlab="Percentage of residents over 25 with a bachelor's degree", 
            ylab="Death Rate",main="Cancer death rate vs. college degrees of residents")
```

The second variable, *PctHS25_Over*, conversely shows an increasing trend with a correlation of `r cor(df$deathRate, df$PctHS25_Over)`.
```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$deathRate, df$PctHS25_Over,  use = 'complete.obs'),5)
scatterplot(df$PctBachDeg25_Over, df$deathRate, xlab="Percentage of residents over 25 with a bachelor's degree",col=c('green1','red', rgb(0,0,0,100,maxColorValue=255)),ylab="Death Rate",main="Cancer death rate vs. college degrees of residents")
```



Overall, these two variables agree with each other: when the percentage of county residents have more education, the mortality rate due to cancer is generally lower.


## Insurance
Death rate Scatterplot and Correlations by 

|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	PctPrivateCoverage		| `r cor(df$deathRate, df$PctPrivateCoverage,  use = 'complete.obs')	`|
|	PctEmpPrivCoverage		| `r cor(df$deathRate, df$PctEmpPrivCoverage,  use = 'complete.obs')	`|
|	PctPublicCoverage		| `r cor(df$deathRate, df$PctPublicCoverage,  use = 'complete.obs')	`|
```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$deathRate, df$PctPublicCoverage,  use = 'complete.obs'),5)
scatterplot(df$PctPublicCoverage, df$deathRate, xlab="Percentage of residents with public insurance", 
     ylab="Death Rate",main="Cancer death rate vs. residents with public insurance",legend ('topleft',bty='n',     legend=paste('r=',r_cor) ), col=c('red','green', rgb(0,0,0,100,maxColorValue=255)))
```


## Employment
 16 years or older
 
|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	PctEmployed16_Over		| `r cor(df$deathRate, df$PctEmployed16_Over,  use = 'complete.obs')	`|
|	PctUnemployed16_Over		| `r cor(df$deathRate, df$PctUnemployed16_Over,  use = 'complete.obs')	`|

```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$deathRate, df$PctEmployed16_Over,  use = 'complete.obs'),5)
scatterplot(df$PctEmployed16_Over, df$deathRate, xlab="Percentage of residents 
    over 16 and employed", ylab="Death Rate",main="Cancer death rate vs. residents 
    with employment",legend ('topleft',bty='n', legend=paste('r=',r_cor) ), 
  col=c('red','green', rgb(0,0,0,100,maxColorValue=255)))
```

## Income

The binned income shows a downward trend in death rate as the binned median incomes increases. 

Median income 
```{r ,fig.height=4, fig.width=12 }
boxplot(df$deathRate ~ df$binnedInc, data = df, cex.axis = .58 ,main = "income categories",
        ylab = "death rate", col='lightskyblue1')
```


|	Independent variable		|	cor to death rate	|
|---------------------|----------------|
|	povertyPercent		| `r cor(df$deathRate, df$povertyPercent,  use = 'complete.obs')	`|
|	medIncome		| `r cor(df$deathRate, df$medIncome,  use = 'complete.obs')`|


```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$deathRate, df$povertyPercent,  use = 'complete.obs'),5)
scatterplot(df$povertyPercent, df$deathRate, xlab="Percentage of residents 
    under poverty level", ylab="Death Rate",main="Cancer death rate vs. percent residents 
    under poverty level",legend ('topleft',bty='n', legend=paste('r=',r_cor) ), 
  col=c('red','green', rgb(0,0,0,100,maxColorValue=255)))
```
```{r,fig.height=4, fig.width=6 }
r_cor = round(cor(df$medIncome, df$povertyPercent,  use = 'complete.obs'),5)
scatterplot(df$povertyPercent, df$medIncome, xlab="Percentage of residents 
    under poverty level", ylab="Death Rate",main="Cancer death rate vs. percent residents 
    under poverty level",legend ('topleft',bty='n', legend=paste('r=',r_cor) ), 
  col=c('red','green', rgb(0,0,0,100,maxColorValue=255)))
```
# Analysis Variables with high correclation and Secondary Effects
```{r}



#Tim place the heat map correlation coefficients map here 




cor(df[, c("MedianAge","PctBlack", "PctHS25_Over",  "PctBachDeg25_Over", "PctPrivateCoverage",
           "PctEmpPrivCoverage", "PctPublicCoverage", "PctEmployed16_Over",  "PctUnemployed16_Over")], use = "complete.obs")
```
# Conclusion
