---
title: "Cancer EDA_Tim_Mike_Craig_W203_4"
author: "Tim, Mike, Craig, Wei"
date: "1/21/2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(car)
library(rmarkdown)
library(ggplot2)
```

## Introduction

This report presents an initial exporatory data analysis identifying the key features associated with cancer rates and deaths based on geographic location in the form of a county in the United States. The  goal is to use the findings from the analysis to develop strategies to improve future outcomes cancer. We are a team of data scientists motivated to in promote understanding the societal factors that impact mortality rates of cancer among various communities in the United States.  We are grateful for the grant awarded to us by a health government agency to complete this study. 

### Research Question

Our task was to answer these two key research quesitons :

1. What are the key county level characteristics associated with mortality rates from cancer?
2. Are there trends in county level characteristics that can be identified to inform social intervention to decrease cancer mortality rates?

### About the Data
```{r Load_dataset}
df <- read.csv("cancer.csv")
class(df) # dimensions are 3047 rows x 30 columns
dim(df) # dimensions of the data set
```
The dataset that we explored had `r nrow(df)` observations and `r ncol(df)` variables.  The death rate was designated the target variable by the health government agency. Each observation represents a single county within the United States, and each variable describes that county for a number of different ways. The dataset provided came with with a mininaml data dictionary and is presented in Table 1. Most of the variables not defined were self explanatory by key notations in the variable name such 'Pct' for percent, 'Avg' for average, and 'med' for median. The units for death rate and birth rates were not provided and without a means to confirm the units we chose to leave these variables without units. We further grouped variables into categories based on similiarities. 


**Table 1. Data Dictionary:**

| Variable Name          | Variable Description                                                       |category         |
|------------------------|----------------------------------------------------------------------------|-----------------|
| deathRate*             | rate of deaths due to cancer                                               |outcome          |
| avgAnnCount            | 2009 - 2013 mean incidents of cancer per county.                           |cancer indcidence|
| Geography*             | Description of county location  (county name, state)                       |county           |
| popEst2015             | County population, estimated during 2015                                   |population/Birth |
| BirthRate*             |                                                                            |population/Birth |
| MedianAge*             | Median age of county residents                                             |age         |
| MedianAgeMale*         | Median age of Male county residents                                        |age         |
| MedianAgeFemale*       | Median age of Female county residents                                      |age         |
| PctWhite*              | % of residents with race designation: White                                |ethnicity   |
| PctBlack*              | % of residents with race designation: Black                                |ethnicity   |
| PctAsian*              | % of residents with race designation: Asian                                |ethnicity   |
| PctOtherRace*          | % of residents with race designation: Other                                |ethnicity   |
| AvgHouseholdSize*      | Average household size, number of people                                   |Household/Marital|
| PercentMarried*        | % maried                                                                   |Household/Marital|
| PctMarriedHouseholds*  | % of households that are married                                           |Household/Marital|
| PctNoHS18_24*          | % of residents, age 18-24, without completing a high school education      |Education        |
| PctHS18_24*            | % of residents, age 18-24, with a high school degree (highest education)   |Education        |
| PctSomeCol18_24*       | % of residents, age 18-24, with some college education (no degree)         |Education        |
| PctBachDeg18_24*       | % of residents, age 18-24, with a bachelor's degree                        |Education        |
| PctHS25_Over*          | % of residents, age over 25, with a high school degree (highest education) |Education        |
| PctBachDeg25_Over*     | % of residents, age over 25, with a bachelors degree                       |Education        |
| PctPrivateCoverage     | % of residents with private insurance coverage                             |insurance        |
| PctEmpPrivCoverage*    | % of residents with employee-provided private insurance coverage           |insurance        |
| PctPublicCoverage      | % of residents with public insurance coverage                              |insurance        |
| PctEmployed16_Over*    | % of residents, age over 16, that are employed                             |Employment       |
| PctUnemployed16_Over*  | % of residents, age over 16, that are unemployed                           |Employment       |
| medIncome*             | Median Income                                                              |income           |
| povertyPercent         | % of county residents living below the poverty line                        |income           |
| binnedInc*             | Binned income level                                                        |income           |
* Not explicitly defined in data dictionary


```{r}
str(df) #names of columns and variable types

```


### Data Quality
Upon inspectoi
Summary function identified some issues:
1. PctEmployed16_Over colum has 2285 missing data
2. death_avgAnnCt_ratio column  > 1 as seen by Max >1.806990; There are 4 obesrvations that meet this criterion


Median Age >100 - replace with NA (i.e. delete) or replace with avg of MedianAgeMale and MedianAgeFemale
 Household size below 1 - replace with NA
 Death Rate / Incidence Rate ratio -there are 4 of these. Initially I wanted to delete but since the time frames may not be the same, it is better to keep and acknowledge within the text of the report.
High Incidence (CaseRate) - We should remove and justify the cutoff used.

```{r summary}
summary(df) 
# note: PctEmployed16_Over has 2285 missing data
# some have are great death_avgAnnCt_ratio  > 1 as seen by Max >1.806990 
```
```{r}
# Dataframe created to count frequency of each county name. 

GeoFreq <-as.data.frame(table(df$Geography))
GeoFreq[GeoFreq$Freq != 1,] # All counties listed only once 
```

```{r}
library(stringr)
GeoFreq$State <- str_split(GeoFreq$Var1,", ")
#GeoFreq$State # would like to find a way to iosolate state to get a state count
```




## Univariate Analysis of Key Variables
### Outcome deathRate


```{r ,fig.height=4, fig.width=11}
# use above to adjust figure dimensions

par(mfrow=c(1,2))
# layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
hist(df$deathRate, main= 'Death Rate',breaks =30, ylab = 'number of counties', xlab = '', labels = TRUE,  ,col = 'gray')
boxplot( df$deathRate,main = "Death Rate of counties in the USA", col = 'gray', ylab = 'Death Rate' , xlab  = paste(c('n = ' ,  sum(df$deathRate>0, na.rm=TRUE) ), collapse= ""))

```

### Average Annual Rate of Cancer

```{r ,fig.height=4, fig.width=11}
# use above to adjust figure dimensions

par(mfrow=c(1,2))
# layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
hist(df$avgAnnCount, main= 'Average Annual count of Cancer',breaks =30, ylab = 'number of counties', xlab = 'Average Annual count of Cancer', labels = TRUE,  ,col = 'gray')
boxplot( df$avgAnnCount,main = "Average Annual count of Cancer", col = 'gray', ylab = 'count of Cancer' , xlab  = paste(c('n = ' ,  sum(df$avgAnnCount>0, na.rm=TRUE) ), collapse= ""))

```

### Population and birth


### Age

### Ethnicity

### Household and Marital status

### Education

### Insurance Coverage


### Employment


### Income



```{r check_levels_binnedInc }
levels(df$binnedInc)
```

```{r ,fig.height=7, fig.width=11}

par(mfrow=c(2,2))
# layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
hist(df$medIncome, main= 'Median Income',breaks =30, ylab = 'number of counties', xlab = '', labels = TRUE,  ,col = 'green4')
boxplot( df$medIncome,main = "Median Income of counties in the USA", col = 'green4', ylab = "Median Income" , xlab  = paste(c('n = ' ,  sum(df$medIncome>0, na.rm=TRUE) ), collapse= ""))

hist(df$povertyPercent, main= 'Poverty Level',breaks =30, ylab = 'number of counties', xlab = 'Percent below Poverty Level', labels = TRUE,  ,col = 'green4')
boxplot( df$povertyPercent,main = "Percent below Poverty Level of counties in the USA", col = 'green4', ylab = "Percent below Poverty Level" , xlab  = paste(c('n = ' ,  sum(df$medIncome>0, na.rm=TRUE) ), collapse= ""))
```




## Analysis of Key Relationships

### Death rate Scatterplot and Correlations by Age 

```{r}
scatterplotMatrix( data=df, ~deathRate + MedianAge + MedianAgeMale  + MedianAgeFemale,diagonal=c("histogram"))
```
```{r}
cor(df[, c("deathRate", "MedianAge",  "MedianAgeMale", "MedianAgeFemale")], use = "complete.obs")
```


### Death rate Scatterplot and Correlations by Ethnicity
```{r}
scatterplotMatrix( data=df, ~deathRate + PctWhite +  PctAsian + PctAsian + PctOtherRace,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "PctWhite",  "PctAsian", "PctAsian", "PctOtherRace")], use = "complete.obs")
```


## Death rate Scatterplot and Correlations by  Household size and Marital status 

```{r}
scatterplotMatrix( data=df, ~ deathRate + PercentMarried + AvgHouseholdSize + PctMarriedHouseholds ,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "PercentMarried",  "AvgHouseholdSize", "PctMarriedHouseholds")], use = "complete.obs")
```




## Death rate Scatterplot and Correlations by Education levels of 18-14 years

```{r}
scatterplotMatrix( data=df, ~deathRate + PctNoHS18_24+  PctHS18_24+  PctSomeCol18_24+  PctBachDeg18_24,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "PctNoHS18_24",  "PctHS18_24", "PctSomeCol18_24", "PctBachDeg18_24")], use = "complete.obs")
```


## Death rate Scatterplot and Correlations by Education levels of 25 years old or older
```{r}
scatterplotMatrix( data=df, ~deathRate + PctHS25_Over+ PctBachDeg25_Over,diagonal=c("histogram"))
```
```{r}
cor(df[, c("deathRate", "PctHS25_Over",  "PctBachDeg25_Over")], use = "complete.obs")
```


## Death rate Scatterplot and Correlations by Insurance

```{r}
scatterplotMatrix( data=df, ~deathRate + PctPrivateCoverage + PctEmpPrivCoverage + PctPublicCoverage,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "PctPrivateCoverage",  "PctEmpPrivCoverage",  "PctPublicCoverage")], use = "complete.obs")
```

#Employment 16 years or older by Death rate
```{r}
scatterplotMatrix( data=df, ~deathRate + PctEmployed16_Over +  PctUnemployed16_Over,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "PctEmployed16_Over",  "PctUnemployed16_Over")], use = "complete.obs")
```

#Income by Death Rate
```{r}
scatterplotMatrix( data=df, ~deathRate + povertyPercent + medIncome   ,diagonal=c("histogram"))
```

```{r}
cor(df[, c("deathRate", "povertyPercent",  "medIncome")], use = "complete.obs")
```


### Analysis of Secondary Effects

## Conclusion